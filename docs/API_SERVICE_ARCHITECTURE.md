# Cryptofeed API Service Architecture Design

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†Cryptofeedé¡¹ç›®çš„ç»Ÿä¸€APIæœåŠ¡æ¶æ„è®¾è®¡ï¼Œè¯¥æ¶æ„å°†æ•°æ®é‡‡é›†å’ŒAPIæœåŠ¡èåˆä¸ºä¸€ä¸ªç»Ÿä¸€çš„`cryptofeed_api`æœåŠ¡ï¼Œæ—¨åœ¨ä¸ºFreqTradeé‡åŒ–äº¤æ˜“ç³»ç»Ÿæä¾›å®Œæ•´çš„æ•°æ®è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ä¸ç›®æ ‡

### å½“å‰æ¶æ„ç—›ç‚¹
1. **å†·å¯åŠ¨é—®é¢˜** - WebSocketåªèƒ½è·å–å®æ—¶æ•°æ®ï¼Œå†å²æ•°æ®éœ€è¦æ…¢æ…¢ç§¯ç´¯
2. **æ•°æ®è¿ç»­æ€§** - æœåŠ¡é‡å¯å¯¼è‡´æ•°æ®æ–­æ¡£
3. **å“åº”å»¶è¿Ÿ** - FreqTradeå¯åŠ¨æ—¶éœ€è¦ç­‰å¾…æ•°æ®ç§¯ç´¯
4. **ç¼ºä¹çµæ´»æ€§** - æ— æ³•æŒ‰éœ€è·å–ç‰¹å®šæ—¶é—´æ®µçš„å†å²æ•°æ®
5. **å­˜å‚¨æˆæœ¬** - é•¿æœŸå­˜å‚¨æ‰€æœ‰å†å²æ•°æ®æˆæœ¬è¾ƒé«˜

### è®¾è®¡ç›®æ ‡
- âœ… æä¾›å¿«é€Ÿçš„å†å²æ•°æ®è¡¥å……æœºåˆ¶
- âœ… ä¿è¯æ•°æ®è¿ç»­æ€§å’Œå®Œæ•´æ€§
- âœ… æ”¯æŒæŒ‰éœ€è·å–ä»»æ„æ—¶é—´æ®µæ•°æ®
- âœ… æ§åˆ¶å­˜å‚¨æˆæœ¬ï¼ŒåŠ¨æ€ç®¡ç†æ•°æ®
- âœ… ç®€åŒ–FreqTradeçš„æ•°æ®è·å–é€»è¾‘

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡ï¼ˆèåˆæ¶æ„ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FreqTrade     â”‚â”€â”€â”€â”€â–¶â”‚          cryptofeed_api                â”‚â”€â”€â”€â”€â–¶â”‚   PostgreSQL    â”‚
â”‚  (é‡åŒ–äº¤æ˜“)      â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚   (TimescaleDB) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚        FastAPI Web Service        â”‚ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚              â–²
                        â”‚  â”‚    â”‚     API Endpoints           â”‚ â”‚ â”‚              â”‚
                        â”‚  â”‚    â”‚ /candles /trades /funding   â”‚ â”‚ â”‚              â”‚
                        â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚              â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
                        â”‚  â”‚    Data Collection Monitor        â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
                        â”‚  â”‚  â”‚    WebSocket Streams        â”‚  â”‚ â”‚
                        â”‚  â”‚  â”‚    Symbol Manager           â”‚  â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                        â”‚  â”‚   Historical Data Service         â”‚ â”‚
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
                        â”‚  â”‚  â”‚  Binance REST Client        â”‚  â”‚ â”‚
                        â”‚  â”‚  â”‚  Data Integrity Check       â”‚  â”‚ â”‚
                        â”‚  â”‚  â”‚  Gap Detection & Fill       â”‚  â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ **èåˆæ¶æ„æ ¸å¿ƒç†å¿µ**

### âœ… **å•ä¸€æœåŠ¡ï¼ŒåŒé‡èŒè´£**
- **æ•°æ®é‡‡é›†**: æŒç»­çš„WebSocketå®æ—¶æ•°æ®æ”¶é›†
- **APIæœåŠ¡**: RESTfulæ¥å£æä¾›æ•°æ®æŸ¥è¯¢å’Œå†å²è¡¥å……
- **å†…å­˜å…±äº«**: ä¸¤ä¸ªåŠŸèƒ½å…±äº«é…ç½®ã€è¿æ¥æ± ã€ç¼“å­˜ç­‰èµ„æº
- **ç»Ÿä¸€ç®¡ç†**: ä¸€ä¸ªè¿›ç¨‹ã€ä¸€ä¸ªé…ç½®ã€ä¸€ä¸ªéƒ¨ç½²å•å…ƒ

### ğŸ—ï¸ **é¡¹ç›®ç»“æ„è®¾è®¡**

```
cryptofeed/                           # åŸcryptofeedåº“
â”œâ”€â”€ cryptofeed/                       # æ ¸å¿ƒäº¤æ˜“æ‰€è¿æ¥åº“
â”œâ”€â”€ examples/                         # å®˜æ–¹ç¤ºä¾‹
â””â”€â”€ docs/                            # åº“æ–‡æ¡£

cryptofeed_api/                      # ç»Ÿä¸€æ•°æ®APIæœåŠ¡ â­
â”œâ”€â”€ __init__.py
â”œâ”€â”€ main.py                          # FastAPI + æ•°æ®é‡‡é›†ç»Ÿä¸€å…¥å£
â”œâ”€â”€ api/                             # Web APIæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ v1/                          # APIç‰ˆæœ¬æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ candles.py              # Kçº¿æ•°æ®ç«¯ç‚¹
â”‚   â”‚   â”œâ”€â”€ trades.py               # äº¤æ˜“æ•°æ®ç«¯ç‚¹
â”‚   â”‚   â”œâ”€â”€ funding.py              # èµ„é‡‘è´¹ç‡ç«¯ç‚¹
â”‚   â”‚   â””â”€â”€ health.py               # å¥åº·æ£€æŸ¥ç«¯ç‚¹
â”‚   â”œâ”€â”€ dependencies.py             # APIä¾èµ–æ³¨å…¥
â”‚   â””â”€â”€ middleware.py               # ä¸­é—´ä»¶
â”œâ”€â”€ monitor/                         # æ•°æ®é‡‡é›†æ¨¡å—ï¼ˆç°æœ‰é€»è¾‘è¿ç§»ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_collector.py           # ä¸»æ•°æ®æ”¶é›†å™¨
â”‚   â”œâ”€â”€ symbol_manager.py           # ç¬¦å·ç®¡ç†å™¨
â”‚   â”œâ”€â”€ backends/                   # å­˜å‚¨åç«¯
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ postgres_backends.py
â”‚   â””â”€â”€ services/                   # é‡‡é›†ç›¸å…³æœåŠ¡
â”œâ”€â”€ services/                       # å…±äº«ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_integrity.py           # æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
â”‚   â”œâ”€â”€ data_supplement.py          # å†å²æ•°æ®è¡¥å……
â”‚   â”œâ”€â”€ binance_client.py           # REST APIå®¢æˆ·ç«¯
â”‚   â””â”€â”€ temp_data_manager.py        # ä¸´æ—¶æ•°æ®ç®¡ç†
â”œâ”€â”€ models/                         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database.py                 # SQLAlchemyæ¨¡å‹
â”‚   â”œâ”€â”€ schemas.py                  # Pydanticå“åº”æ¨¡å‹
â”‚   â””â”€â”€ enums.py                    # æšä¸¾ç±»å‹
â”œâ”€â”€ core/                           # æ ¸å¿ƒé…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py                   # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database.py                 # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ logging.py                  # æ—¥å¿—é…ç½®
â””â”€â”€ utils/                          # å·¥å…·ç±»
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ helpers.py
    â””â”€â”€ validators.py

run.py                               # ç»Ÿä¸€å¯åŠ¨è„šæœ¬
config/main.yaml                     # ç»Ÿä¸€é…ç½®æ–‡ä»¶
```

### ğŸ”„ **æœåŠ¡å¯åŠ¨æµç¨‹**

```python
# main.py - ç»Ÿä¸€å…¥å£ç‚¹
from fastapi import FastAPI
import asyncio

app = FastAPI(title="Cryptofeed API Service")

@app.on_event("startup")
async def startup_event():
    # 1. åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
    await init_database()

    # 2. æ£€æŸ¥æ•°æ®å®Œæ•´æ€§å¹¶è¡¥å……
    await check_and_supplement_data()

    # 3. å¯åŠ¨WebSocketæ•°æ®é‡‡é›†
    asyncio.create_task(start_data_collection())

    # 4. APIæœåŠ¡å°±ç»ª
    logger.info("Cryptofeed API Service Ready")

@app.get("/api/v1/candles/{symbol}")
async def get_candles(symbol: str):
    # ç›´æ¥æŸ¥è¯¢åŒä¸€ä¸ªæ•°æ®åº“
    return await query_candles(symbol)
```

## ğŸ”„ æ ¸å¿ƒå·¥ä½œæµç¨‹

### 1. æœåŠ¡å¯åŠ¨æµç¨‹
```mermaid
graph TD
    A[APIæœåŠ¡å¯åŠ¨] --> B[æ£€æŸ¥æ•°æ®å®Œæ•´æ€§]
    B --> C{å‘ç°æ•°æ®æ–­æ¡£?}
    C -->|æ˜¯| D[å¯åŠ¨REST APIè¡¥å……]
    C -->|å¦| E[æœåŠ¡å°±ç»ª]
    D --> F[æ‰¹é‡è·å–å†å²æ•°æ®]
    F --> G[å­˜å‚¨åˆ°æ•°æ®åº“]
    G --> H[ç»§ç»­æ£€æŸ¥ä¸‹ä¸€æ®µ]
    H --> I{æ‰€æœ‰æ–­æ¡£ä¿®å¤?}
    I -->|æ˜¯| E
    I -->|å¦| F
    E --> J[å¼€å¯WebSocketé‡‡é›†]
```

### 2. æ•°æ®è¯·æ±‚æµç¨‹
```mermaid
graph TD
    A[FreqTradeè¯·æ±‚æ•°æ®] --> B[APIæ¥æ”¶è¯·æ±‚]
    B --> C[æŸ¥è¯¢æ•°æ®åº“]
    C --> D{æ•°æ®å®Œæ•´?}
    D -->|æ˜¯| E[ç›´æ¥è¿”å›æ•°æ®]
    D -->|å¦| F[è®¡ç®—ç¼ºå¤±èŒƒå›´]
    F --> G[REST APIè¡¥å……æ•°æ®]
    G --> H[å­˜å‚¨è¡¥å……æ•°æ®]
    H --> I[è¿”å›å®Œæ•´æ•°æ®]
```

### 3. ä¸´æ—¶æ•°æ®æ‰©å±•æµç¨‹
```mermaid
graph TD
    A[å›æµ‹éœ€æ±‚è¶…å‡ºå­˜å‚¨èŒƒå›´] --> B[åˆ›å»ºä¸´æ—¶è¡¨/åˆ†åŒº]
    B --> C[REST APIè·å–é¢å¤–æ•°æ®]
    C --> D[å­˜å‚¨åˆ°ä¸´æ—¶è¡¨]
    D --> E[è¿”å›å®Œæ•´æ•°æ®é›†]
    E --> F[å›æµ‹å®Œæˆ]
    F --> G[è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ•°æ®]
```

## ğŸš€ æ€§èƒ½ä¸æ•ˆç‡ä¼˜åŒ–

### REST API vs WebSocket æ•ˆç‡å¯¹æ¯”
| æ–¹å¼ | 1å¹´5åˆ†é’Ÿæ•°æ®è·å–æ—¶é—´ | ä¼˜ç¼ºç‚¹ |
|------|---------------------|--------|
| **WebSocketé€æ¡** | ~28å°æ—¶ | âŒ ææ…¢ï¼Œéœ€è¦å®æ—¶ç­‰å¾… |
| **REST APIæ‰¹é‡** | ~2-3å°æ—¶ | âœ… å¿«é€Ÿï¼Œå—é™äºAPIé™æµ |

### APIé™æµç®¡ç†ç­–ç•¥
- **Binanceé™åˆ¶**ï¼š1200è¯·æ±‚/åˆ†é’Ÿï¼Œ10è¯·æ±‚/ç§’
- **æ‰¹æ¬¡æ§åˆ¶**ï¼šæ¯æ¬¡è¯·æ±‚è·å–æœ€å¤§å…è®¸æ•°æ®é‡
- **æ™ºèƒ½é—´éš”**ï¼šåŠ¨æ€è°ƒæ•´è¯·æ±‚é¢‘ç‡ï¼Œé¿å…è§¦ç¢°é™åˆ¶
- **æ–­ç‚¹ç»­ä¼ **ï¼šæ”¯æŒä¸­æ–­åä»æ–­ç‚¹ç»§ç»­è¡¥å……

### å­˜å‚¨æˆæœ¬ä¼˜åŒ–
```yaml
æ•°æ®ä¿ç•™ç­–ç•¥:
  å¸¸è§„å­˜å‚¨: 1å¹´æ•°æ® (~100MB/symbol)
  ä¸´æ—¶æ‰©å±•: æŒ‰éœ€åˆ›å»ºï¼Œè‡ªåŠ¨æ¸…ç†
  åˆ†åŒºç®¡ç†: æŒ‰æœˆåˆ†åŒºï¼Œä¾¿äºç®¡ç†
  å‹ç¼©ä¼˜åŒ–: TimescaleDBè‡ªåŠ¨å‹ç¼©å†å²æ•°æ®
```

## ğŸ› ï¸ APIæ¥å£è®¾è®¡

### æ ¸å¿ƒç«¯ç‚¹è§„åˆ’
```http
# è·å–Kçº¿æ•°æ®
GET /api/v1/candles/{symbol}/{interval}
Query: start_time, end_time, limit

# è·å–äº¤æ˜“æ•°æ®
GET /api/v1/trades/{symbol}
Query: start_time, end_time, limit

# è·å–èµ„é‡‘è´¹ç‡
GET /api/v1/funding/{symbol}
Query: start_time, end_time

# æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
GET /api/v1/health/data-integrity/{symbol}

# ä¸´æ—¶æ•°æ®ç®¡ç†
POST /api/v1/temp-data/create
DELETE /api/v1/temp-data/{temp_id}
```

### å“åº”æ ¼å¼ç»Ÿä¸€
```json
{
  "status": "success",
  "data": [...],
  "metadata": {
    "symbol": "BTC-USDT-PERP",
    "interval": "5m",
    "count": 10000,
    "start_time": "2023-01-01T00:00:00Z",
    "end_time": "2024-01-01T00:00:00Z",
    "data_source": "database|rest_api",
    "completeness": 100
  }
}
```

## ğŸ”’ æ•°æ®å®Œæ•´æ€§ä¿éšœ

### æ–­æ¡£æ£€æµ‹æœºåˆ¶
```python
def detect_data_gaps(symbol: str, interval: str, start: datetime, end: datetime):
    """
    æ£€æµ‹æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®æ–­æ¡£
    è¿”å›éœ€è¦è¡¥å……çš„æ—¶é—´æ®µåˆ—è¡¨
    """
    expected_count = calculate_expected_records(interval, start, end)
    actual_count = query_actual_records(symbol, interval, start, end)

    if actual_count < expected_count:
        return find_missing_ranges(symbol, interval, start, end)
    return []
```

### æ•°æ®è´¨é‡éªŒè¯
- **æ—¶é—´æˆ³è¿ç»­æ€§**ï¼šæ£€æŸ¥Kçº¿æ•°æ®æ—¶é—´é—´éš”æ˜¯å¦æ­£ç¡®
- **æ•°æ®åˆç†æ€§**ï¼šä»·æ ¼ã€äº¤æ˜“é‡ç­‰æ•°å€¼èŒƒå›´éªŒè¯
- **é‡å¤æ£€æµ‹**ï¼šé¿å…è¡¥å……æ•°æ®æ—¶äº§ç”Ÿé‡å¤è®°å½•
- **å®Œæ•´æ€§è¯„åˆ†**ï¼šè®¡ç®—æ•°æ®å®Œæ•´åº¦ç™¾åˆ†æ¯”

## ğŸ“Š ç›‘æ§ä¸è¿ç»´

### å…³é”®æŒ‡æ ‡ç›‘æ§
```yaml
æ€§èƒ½æŒ‡æ ‡:
  - APIå“åº”æ—¶é—´
  - æ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿ
  - REST APIè°ƒç”¨é¢‘ç‡
  - æ•°æ®è¡¥å……é€Ÿåº¦

æ•°æ®æŒ‡æ ‡:
  - æ•°æ®å®Œæ•´æ€§ç™¾åˆ†æ¯”
  - å®æ—¶æ•°æ®å»¶è¿Ÿ
  - å­˜å‚¨ç©ºé—´ä½¿ç”¨ç‡
  - ä¸´æ—¶æ•°æ®æ¸…ç†çŠ¶æ€

ç³»ç»ŸæŒ‡æ ‡:
  - CPUå’Œå†…å­˜ä½¿ç”¨ç‡
  - æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
  - WebSocketè¿æ¥çŠ¶æ€
  - é”™è¯¯ç‡å’Œé‡è¯•æ¬¡æ•°
```

### å‘Šè­¦ç­–ç•¥
- **æ•°æ®æ–­æ¡£è¶…è¿‡1å°æ—¶** â†’ ç«‹å³å‘Šè­¦
- **APIå“åº”æ—¶é—´è¶…è¿‡5ç§’** â†’ æ€§èƒ½å‘Šè­¦
- **å­˜å‚¨ç©ºé—´ä½¿ç”¨è¶…è¿‡80%** â†’ å®¹é‡å‘Šè­¦
- **REST APIé™æµè§¦å‘** â†’ é™æµå‘Šè­¦

## ğŸ›¡ï¸ å®¹é”™ä¸æ¢å¤æœºåˆ¶

### æ•…éšœåœºæ™¯å¤„ç†
1. **REST APIè¯·æ±‚å¤±è´¥**
   - æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶
   - é™çº§ç­–ç•¥ï¼šè¿”å›éƒ¨åˆ†å¯ç”¨æ•°æ®
   - å¤±è´¥è®°å½•ï¼šå¾…åç»­è¡¥å……

2. **æ•°æ®åº“è¿æ¥ä¸­æ–­**
   - è¿æ¥æ± è‡ªåŠ¨é‡è¿
   - è¯·æ±‚é˜Ÿåˆ—ç¼“å­˜
   - å¥åº·æ£€æŸ¥ç«¯ç‚¹

3. **WebSocketè¿æ¥æ–­å¼€**
   - è‡ªåŠ¨é‡è¿æœºåˆ¶
   - æ–­çº¿æœŸé—´æ•°æ®è¡¥å……
   - çŠ¶æ€åŒæ­¥éªŒè¯

### æ•°æ®ä¸€è‡´æ€§ä¿è¯
```python
@transaction
def supplement_historical_data(symbol: str, start: datetime, end: datetime):
    """
    äº‹åŠ¡ä¿è¯ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š
    """
    try:
        gaps = detect_data_gaps(symbol, start, end)
        for gap in gaps:
            data = fetch_from_binance_rest(symbol, gap.start, gap.end)
            validate_data_quality(data)
            store_to_database(data)
        commit_transaction()
    except Exception as e:
        rollback_transaction()
        raise DataSupplementError(f"Failed to supplement data: {e}")
```

## ğŸš€ éƒ¨ç½²ä¸æ‰©å±•

### DockeråŒ–éƒ¨ç½²ï¼ˆèåˆæ¶æ„ï¼‰
```yaml
# docker-compose.yml
services:
  cryptofeed-api:
    build: .
    environment:
      - DATABASE_HOST=timescale-crypto
      - DATABASE_PORT=5432
      - DATABASE_USER=postgres
      - DATABASE_PASSWORD=password
      - DATABASE_NAME=cryptofeed
    ports:
      - "8000:8000"     # FastAPIæœåŠ¡ç«¯å£
    depends_on:
      - timescale-crypto
    volumes:
      - ./logs:/app/logs
      - ./config:/app/config
    restart: unless-stopped

  timescale-crypto:
    image: timescale/timescaledb:latest
    environment:
      - POSTGRES_DB=cryptofeed
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

volumes:
  postgres_data:
```

### ç®€åŒ–çš„Dockerfile
```dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y gcc && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶å¹¶å®‰è£…Pythonä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY cryptofeed_api/ ./cryptofeed_api/
COPY cryptofeed/ ./cryptofeed/
COPY config/ ./config/
COPY run.py .

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8000/health || exit 1

EXPOSE 8000

# å¯åŠ¨ç»Ÿä¸€æœåŠ¡
CMD ["python", "run.py"]
```

### æ°´å¹³æ‰©å±•ç­–ç•¥
- **APIæœåŠ¡**ï¼šå¤šå®ä¾‹è´Ÿè½½å‡è¡¡
- **æ•°æ®é‡‡é›†**ï¼šæŒ‰äº¤æ˜“å¯¹åˆ†ç‰‡
- **æ•°æ®åº“**ï¼šTimescaleDBåˆ†å¸ƒå¼éƒ¨ç½²
- **ç¼“å­˜å±‚**ï¼šå¯é€‰Redisé›†ç¾¤ï¼ˆæŒ‰éœ€ï¼‰

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### å¼€å‘å®è·µ
1. **APIç‰ˆæœ¬ç®¡ç†** - ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œä¿è¯å‘åå…¼å®¹
2. **é”™è¯¯å¤„ç†** - ç»Ÿä¸€é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯æ ¼å¼
3. **æ—¥å¿—è§„èŒƒ** - ç»“æ„åŒ–æ—¥å¿—ï¼Œä¾¿äºç›‘æ§å’Œè°ƒè¯•
4. **æ–‡æ¡£ç»´æŠ¤** - APIæ–‡æ¡£å®æ—¶æ›´æ–°ï¼ŒåŒ…å«ç¤ºä¾‹ä»£ç 

### è¿ç»´å®è·µ
1. **æ¸è¿›å¼å‘å¸ƒ** - ç°åº¦å‘å¸ƒï¼Œç›‘æ§æŒ‡æ ‡
2. **æ•°æ®å¤‡ä»½** - å®šæœŸå¤‡ä»½å…³é”®æ•°æ®
3. **å®¹é‡è§„åˆ’** - ç›‘æ§å¢é•¿è¶‹åŠ¿ï¼Œæå‰æ‰©å®¹
4. **å®‰å…¨åŠ å›º** - APIè®¿é—®æ§åˆ¶ï¼Œæ•°æ®ä¼ è¾“åŠ å¯†

## ğŸ“ˆ æœªæ¥æ‰©å±•æ–¹å‘

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-3ä¸ªæœˆï¼‰
- [ ] å®ç°åŸºç¡€APIæœåŠ¡å’Œæ•°æ®è¡¥å……åŠŸèƒ½
- [ ] å®Œæˆä¸FreqTradeçš„é›†æˆæµ‹è¯•
- [ ] å»ºç«‹ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
- [ ] ä¼˜åŒ–æ•°æ®è¡¥å……ç®—æ³•æ•ˆç‡

### ä¸­æœŸæ‰©å±•ï¼ˆ3-6ä¸ªæœˆï¼‰
- [ ] æ”¯æŒæ›´å¤šäº¤æ˜“æ‰€æ•°æ®æº
- [ ] å®ç°æ™ºèƒ½æ•°æ®é¢„åŠ è½½
- [ ] å¢åŠ æ•°æ®åˆ†æå’Œç»Ÿè®¡åŠŸèƒ½
- [ ] å¼€å‘Webç®¡ç†ç•Œé¢

### é•¿æœŸè§„åˆ’ï¼ˆ6-12ä¸ªæœˆï¼‰
- [ ] æœºå™¨å­¦ä¹ é©±åŠ¨çš„æ•°æ®è´¨é‡ä¼˜åŒ–
- [ ] åˆ†å¸ƒå¼æ¶æ„æ”¯æŒ
- [ ] å®æ—¶æ•°æ®æµå¤„ç†ä¼˜åŒ–
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ

## ğŸ“ æ€»ç»“

æœ¬æ¶æ„è®¾è®¡é€šè¿‡**èåˆæ¶æ„**ï¼Œå°†æ•°æ®é‡‡é›†å’ŒAPIæœåŠ¡ç»Ÿä¸€åˆ°`cryptofeed_api`ä¸­ï¼Œæœ‰æ•ˆè§£å†³äº†å½“å‰Cryptofeedé¡¹ç›®çš„æ•°æ®ç®¡ç†ç—›ç‚¹ï¼š

**âœ… æ ¸å¿ƒä¼˜åŠ¿**
- **æ¶æ„ç®€æ´**ï¼šå•ä¸€æœåŠ¡ï¼ŒåŒé‡èŒè´£ï¼Œé¿å…å¾®æœåŠ¡å¤æ‚æ€§
- **å¿«é€Ÿå†·å¯åŠ¨**ï¼šREST APIæ‰¹é‡è¡¥å……ï¼Œæ¯”WebSocketé€æ¡å¿«10å€ä»¥ä¸Š
- **æ•°æ®å®Œæ•´æ€§**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤æ•°æ®æ–­æ¡£ï¼Œä¿è¯è¿ç»­æ€§
- **æˆæœ¬å¯æ§**ï¼šåŠ¨æ€æ•°æ®ç®¡ç†ï¼ŒæŒ‰éœ€æ‰©å±•ï¼Œæ— éœ€Redisç¼“å­˜
- **å†…å­˜å…±äº«**ï¼šæ•°æ®é‡‡é›†å’ŒAPIæœåŠ¡å…±äº«èµ„æºï¼Œæ€§èƒ½æ›´ä¼˜
- **éƒ¨ç½²ç®€å•**ï¼šå•å®¹å™¨éƒ¨ç½²ï¼Œè¿ç»´æˆæœ¬ä½
- **é«˜åº¦å…¼å®¹**ï¼šæ— ç¼é›†æˆç°æœ‰FreqTradeå·¥ä½œæµç¨‹

**ğŸ¯ èåˆæ¶æ„æ ¸å¿ƒä»·å€¼**
- **ç»Ÿä¸€ç®¡ç†**ï¼šä¸€ä¸ªé…ç½®æ–‡ä»¶ã€ä¸€ä¸ªå¯åŠ¨è„šæœ¬ã€ä¸€ä¸ªéƒ¨ç½²å•å…ƒ
- **å®æ—¶å“åº”**ï¼šå†…å­˜ç›´æ¥è®¿é—®ï¼Œæ— è·¨æœåŠ¡é€šä¿¡å»¶è¿Ÿ
- **èµ„æºä¼˜åŒ–**ï¼šå…±äº«æ•°æ®åº“è¿æ¥æ± ã€é…ç½®ç®¡ç†ã€æ—¥å¿—ç³»ç»Ÿ
- **å¼€å‘é«˜æ•ˆ**ï¼šä»£ç å¤ç”¨ç‡é«˜ï¼Œç»´æŠ¤æˆæœ¬ä½

**ğŸ“Š å®æ–½è·¯å¾„**
1. **æ¸è¿›è¿ç§»**ï¼šå°†ç°æœ‰`src/`ä»£ç è¿ç§»åˆ°`cryptofeed_api/monitor/`
2. **åŠŸèƒ½å åŠ **ï¼šåœ¨åŒä¸€æœåŠ¡ä¸­é›†æˆFastAPI Webæ¡†æ¶
3. **ç»Ÿä¸€å…¥å£**ï¼šé€šè¿‡`main.py`åŒæ—¶å¯åŠ¨æ•°æ®é‡‡é›†å’ŒAPIæœåŠ¡
4. **DockeråŒ–**ï¼šå•å®¹å™¨åŒ…å«å®Œæ•´åŠŸèƒ½ï¼Œç®€åŒ–éƒ¨ç½²

**ğŸš€ é€‚ç”¨åœºæ™¯**
è¯¥èåˆæ¶æ„ç‰¹åˆ«é€‚åˆï¼š
- ä¸ªäººæˆ–å°å›¢é˜Ÿçš„é‡åŒ–äº¤æ˜“é¡¹ç›®
- å¯¹æ¶æ„å¤æ‚åº¦æ•æ„Ÿçš„åœºæ™¯
- èµ„æºï¼ˆå†…å­˜ã€CPUï¼‰æœ‰é™çš„ç¯å¢ƒ
- éœ€è¦å¿«é€Ÿè¿­ä»£çš„é¡¹ç›®

è¯¥æ¶æ„ä¸ºCryptofeedé¡¹ç›®çš„ç”Ÿäº§åŒ–éƒ¨ç½²å¥ å®šäº†åšå®åŸºç¡€ï¼Œèƒ½å¤Ÿä»¥æœ€ç®€æ´çš„æ–¹å¼æ»¡è¶³ä¸“ä¸šé‡åŒ–äº¤æ˜“çš„æ•°æ®éœ€æ±‚ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2024-09-25
**æ›´æ–°æ—¥æœŸ**: 2024-09-25
**ä½œè€…**: Cryptofeed Team

> ğŸ’¡ **æç¤º**: æœ¬æ–‡æ¡£å°†éšç€é¡¹ç›®å‘å±•æŒç»­æ›´æ–°ï¼Œå»ºè®®å®šæœŸæŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ã€‚